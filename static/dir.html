<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="/static/css/dir.css">
		<link rel="stylesheet" type="text/css" href="/static/css/style.css">
	</head>
	<body>
		<div class = 'title'></div>
		<div class = 'buttons'>
			<div class = 'button'>make new file</div>
		</div>
		<div class = 'cols'>
		</div>
		<div id = 'newFile'>
			<div class='header'>Make a new file</div>
			<div>
				Make a file named: <input type = 'text'/> <div class = 'button' style = 'display:inline-block;float:none;'>Go</div> <div class = 'button' style = 'display:inline-block;float:none;'>Show template menu</div>
			</div>
			<br>
			<div> Copy from: <input type = 'text'/><div class = 'button' style = 'display:inline-block;float:none;'>Go</div></div>
			<br>
			<div id = 'files'></div>
			<br>

		</div>
		<script type='text/javascript' src='/static/js/jquery.js'></script>
		<script type='text/javascript' src='/static/js/helpers.js'></script>
		<script type='text/javascript'>
			$('#newFile').hide();
			var dirs = ["button3.html","competition/","customize.html","dangerous/","dynamic.html","first.html","ftc.html","idonotknow.html","inputs.html","packedbombs.html","randomlinks.html","scamtest.html","sorryanothertest.css","test1/","thisisanothertest/","thisisatestofekdabbler.html","undefined","viralprize.html","worlddomination.html"];

			setUpUI();
			$(window).on('resize', function() {
				loadDirs(dirs);
			});

			function setUpUI() {
				$('.title').html(join('codezoo/',window.location.pathname));
				setTimeout(function(){loadDirs(dirs)}, 1);
			}

			function loadDirs(dirList, target, colWidthCutoff) { //
				if (!target) {
					target = $(".cols");
				}

				if (!colWidthCutoff) {
					colWidthCutoff = 300;
				}

				var dirs = [];
				var files = [];

				for (var i in dirList) {
					var t = dirList[i];
					if (t.charAt(t.length - 1) == '/') {
						dirs.push(t);
					} else {
						files.push(t);
					}
				}

				dirs = dirs.sort(function(a,b){
					if (a < b) return -1;
					if (a > b) return 1;
					return 0;
				});

				files = files.sort(function(a,b){
					if (a < b) return -1;
					if (a > b) return 1;
					return 0;
				});

				var numCols = Math.floor(target.width() / colWidthCutoff) || 1;

				target.empty();
				var dirsPerCol = Math.ceil(dirList.length/numCols 	);
				var colWidth = ((1/numCols) * 100);
				var cols = [];
				var colWidthCSS = 'calc(' + colWidth + '% - 20px)';
				for (var i = 0; i < numCols; i++) {
					var col = $('<div>', {class:'col'});
					col.css('margin-left', i * colWidth + '%');
					col.css('width',colWidthCSS);
					col.css('z-index', i + 1);
					target.append(col);
					cols.push(col);
				}

				dirs = dirs.concat(files);

				for (var i = 0; i < dirs.length; i++) {
					var colNum = Math.floor(i/dirsPerCol);
					var item = $('<div>', {class:'item'});
					var itemName = $("<span>", {class:'itemName', text:dirs[i], title:"View " + join(window.location.pathname, dirs[i])});
					item.append(itemName);
					// var auxClass = colNum == numCols - 1 ? 'auxText' : 'auxText bordered';
					var auxText = $('<span>', {class:'', html:'&nbsp;'});
					if (dirs[i].charAt(dirs[i].length - 1) != '/') {
						var editText = $('<a>', {class:'editText', text:'edit', href:join('/edit/', window.location.pathname.substr('/view/'.length), dirs[i]), title:"Edit " + join(window.location.pathname, dirs[i])});

						auxText.append(editText);
					}

					item.append(auxText);
					cols[colNum].append(item);
					if (item[0].offsetWidth < item[0].scrollWidth) {
						auxText.attr('class','auxText');
					}
				}
			}

			(function showNewfile() {
				$('#newFile').show();
				loadDirs(["button3.html","customize.html","dynamic.html","first.html","ftc.html","idonotknow.html","inputs.html","packedbombs.html","randomlinks.html","scamtest.html","sorryanothertest.css","thisisatestofekdabbler.html","undefined","viralprize.html","worlddomination.html"], $('#files'))
			})();
		</script>
	</body>
</html>
